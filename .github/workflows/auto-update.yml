name: Actualizaci√≥n Autom√°tica de Datos

on:
  schedule:
    - cron: '0 6,18 * * *'  # 6 AM y 6 PM UTC (3 AM y 3 PM Argentina)
  workflow_dispatch:  # Para ejecuci√≥n manual

jobs:
  actualizar-datos:
    runs-on: ubuntu-latest
    
    steps:
    - name: ‚¨áÔ∏è Descargar repositorio
      uses: actions/checkout@v4
      
    - name: üêç Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: üì¶ Instalar dependencias
      run: |
        sudo apt-get update
        sudo apt-get install -y chromium-browser chromium-chromedriver
        pip install selenium pandas geopandas openpyxl
        
    - name: üöÄ Ejecutar descarga de datos
      env:
        MULTIRIESGO_USUARIO: ${{ secrets.MULTIRIESGO_USUARIO }}
        MULTIRIESGO_CONTRASENA: ${{ secrets.MULTIRIESGO_CONTRASENA }}
      run: |
        echo "üîê Iniciando descarga..."
        python scripts/proceso_completo.py
        echo "‚úÖ Proceso completado"
        
    - name: üì§ Subir SOLO GeoJSON actualizado
      run: |
        git config --global user.name "github-actions"
        git config --global user.email "github-actions@github.com"
        
        echo "üìä Subiendo cambios de datos..."
        
        # Agregar SOLO archivos de datos
        git add data/poligonos.geojson 2>/dev/null || echo "‚ö†Ô∏è poligonos.geojson no existe"
        git add data/poligonos_actualizados.geojson 2>/dev/null || echo "‚ö†Ô∏è poligonos_actualizados.geojson no existe"
        git add data/datos_actualizados.xlsx 2>/dev/null || echo "‚ö†Ô∏è datos_actualizados.xlsx no existe"
        
        # Verificar si hay cambios REALES
        if git diff --cached --quiet; then
          echo "üì≠ No hay cambios en los datos"
        else
          git commit -m "üó∫Ô∏è Actualizaci√≥n de datos - $(date '+%d/%m/%Y %H:%M')" || echo "‚ö†Ô∏è Commit vac√≠o"
          git push
          echo "‚úÖ Datos actualizados en GitHub"
        fi
