name: ActualizaciÃ³n AutomÃ¡tica Diaria

on:
  schedule:
    # Ejecuta a las 6 AM y 6 PM UTC (3 AM y 3 PM Argentina)
    - cron: '0 6,18 * * *'
  workflow_dispatch:  # Permite ejecuciÃ³n manual

jobs:
  actualizar:
    runs-on: ubuntu-latest
    
    steps:
    - name: â¬‡ï¸ Descargar repositorio
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: ğŸ Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: ğŸ“¦ Instalar Chrome y dependencias
      run: |
        sudo apt-get update
        sudo apt-get install -y chromium-browser chromium-chromedriver
        pip install selenium webdriver-manager pandas openpyxl geopandas shapely
        
    - name: ğŸš€ Ejecutar proceso completo
      env:
        MULTIRIESGO_USUARIO: ${{ secrets.MULTIRIESGO_USUARIO }}
        MULTIRIESGO_CONTRASENA: ${{ secrets.MULTIRIESGO_CONTRASENA }}
      run: |
        echo "ğŸ” Usuario configurado"
        mkdir -p data app
        python scripts/proceso_completo.py
        
    - name: ğŸ“¤ Subir cambios a GitHub
      run: |
        git config --global user.name "github-actions"
        git config --global user.email "github-actions@github.com"
        
        # Verificar quÃ© archivos se generaron
        echo "ğŸ“ Archivos generados:"
        ls -la data/ || echo "No hay data/"
        ls -la app/ || echo "No hay app/"
        
        # Agregar TODO lo nuevo
        git add .
        
        # Commit solo si hay cambios
        if ! git diff --cached --quiet; then
          git commit -m "ğŸ”„ ActualizaciÃ³n automÃ¡tica - $(date '+%d/%m/%Y %H:%M')"
          git push
          echo "âœ… Cambios subidos a GitHub"
        else
          echo "ğŸ“­ No hay cambios para commit"
        fi
